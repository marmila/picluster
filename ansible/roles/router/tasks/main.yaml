---

- name: Enable IP forwarding
  sysctl:
    name: net.ipv4.ip_forward
    value: '1'
    sysctl_set: true
    state: present
    reload: true

- name: Ensure Nftables packages is installed
  package:
    name: '{{ nft_pkg_list | list }}'
    state: present
  register: nft_pkg_install_result
  until: nft_pkg_install_result is success

- name: Ensure old Iptables packages are removed
  package:
    name: '{{ nft_old_pkg_list | list }}'
    state: absent
  register: pkg_remove_result
  until: pkg_remove_result is success

- name: Ensure nftables service is enabled and started
  service:
    name: nftables
    state: started
    enabled: true

- name: NFTables generate main conf file
  template:
    src: "{{ nft_main_conf_content }}"
    dest: "{{ nft_main_conf_path }}"
    owner: root
    group: root
    mode: 0755
    backup: "{{ nft_backup_conf }}"
  notify: ['Reload nftables service']
