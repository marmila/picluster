---
- name: Clean Longhorn storage
  shell: "rm -rf /storage/*"
  args:
    executable: /bin/bash
  changed_when: true

- name: Clean longhorn iscsi targets and nodes
  shell: |
    for i in `sudo iscsiadm -m discovery -o show | grep -v 10.0.0.1 | awk '{print $1}'`
    do
    echo "Deleting target $i"
    sudo iscsiadm -m discovery -p $i -o delete
    done
  register: output
  changed_when: true

- name: Clean container/pod logs
  shell: "rm -rf /var/log/pods /var/log/containers"
  args:
    executable: /bin/bash
  ignore_errors: true
  changed_when: true

- name: Clean fluentd pos files
  shell: "rm /var/log/*.pos"
  args:
    executable: /bin/bash
  ignore_errors: true
  changed_when: true
